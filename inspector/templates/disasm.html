{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="/static/prism.css">
    <style>
      pre[class*="language-"], pre code {
        background: #f8f9fa;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        margin: 1rem 0;
      }
      .line-numbers .line-numbers-rows {
        border-right: 1px solid #ddd;
      }
    </style>
{% endblock %}

{% block above_body %}
    <div class="bg-gradient-to-r from-python-yellow to-python-yellow-dark rounded-lg p-6 mb-6 shadow-lg">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Analysis Summary</h3>
        <ul class="space-y-2">
            {% for detail in file_details %}
                <li class="flex items-start">
                    <svg class="w-5 h-5 text-gray-700 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-gray-800">{{ detail|safe }}</span>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endblock %}

{% block body %}
    <div class="space-y-4">
        <div class="flex justify-between items-center">
            <div class="bg-white border-2 border-gray-200 rounded-lg inline-flex p-1">
                <button type="button" id="disassembly-btn" 
                        class="px-4 py-2 rounded-md text-sm font-medium bg-python-blue text-white transition-all duration-200">
                    Disassembly
                </button>
                <button type="button" id="decompilation-btn"
                        class="px-4 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-gray-900 transition-all duration-200">
                    Decompilation
                </button>
            </div>
            
            <a href="{{ mailto_report_link }}" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                Report Malicious Package
            </a>
        </div>
        
        <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
            <div class="bg-python-blue text-white px-4 py-2">
                <span class="font-mono text-sm" id="code-header">DISASSEMBLY</span>
            </div>
            <pre id="disassembly" class="m-0 p-4">
{# Indenting the below <code> tags will cause rendering issues! #}
<code>{{- disassembly }}</code>
            </pre>
            <pre id="decompilation" style="display: none" class="line-numbers linkable-line-numbers language-python m-0">
{# Indenting the below <code> tags will cause rendering issues! #}
<code class="language-python">{{- decompilation }}</code>
            </pre>
        </div>
    </div>

    <script>
        let disassembly = document.getElementById("disassembly");
        let decompilation = document.getElementById("decompilation");
        let disassemblyBtn = document.getElementById("disassembly-btn");
        let decompilationBtn = document.getElementById("decompilation-btn");
        let codeHeader = document.getElementById("code-header");

        disassemblyBtn.addEventListener("click", function () {
            disassembly.style.display = "";
            decompilation.style.display = "none";
            
            disassemblyBtn.classList.add("bg-python-blue", "text-white");
            disassemblyBtn.classList.remove("text-gray-700", "hover:text-gray-900");
            decompilationBtn.classList.remove("bg-python-blue", "text-white");
            decompilationBtn.classList.add("text-gray-700", "hover:text-gray-900");
            
            codeHeader.textContent = "DISASSEMBLY";
        });

        decompilationBtn.addEventListener("click", function () {
            disassembly.style.display = "none";
            decompilation.style.display = "";
            
            decompilationBtn.classList.add("bg-python-blue", "text-white");
            decompilationBtn.classList.remove("text-gray-700", "hover:text-gray-900");
            disassemblyBtn.classList.remove("bg-python-blue", "text-white");
            disassemblyBtn.classList.add("text-gray-700", "hover:text-gray-900");
            
            codeHeader.textContent = "DECOMPILATION";

            // line numbers get messed up when changing the display attribute, so we need to refresh them...
            if (typeof Prism !== 'undefined' && Prism.plugins && Prism.plugins.lineNumbers) {
                Prism.plugins.lineNumbers.resize(decompilation);
            }
        });
    </script>

    <script src="/static/prism.js"></script>
{% endblock %}
